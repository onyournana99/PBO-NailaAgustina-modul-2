# CLASS BUKU 
class Buku:
    def __init__(self, judul, penulis, kode_buku, stok, lokasi_rak):
        self.judul = judul              # public
        self.penulis = penulis          # public
        self.kode_buku = kode_buku      # public
        self._stok = stok               # protected
        self.__lokasi_rak = lokasi_rak  # private

    # Getter & Setter lokasi rak (private)
    def get_lokasi_rak(self):
        return self.__lokasi_rak

    def set_lokasi_rak(self, lokasi_baru):
        self.__lokasi_rak = lokasi_baru

    # Tambah stok
    def tambah_stok(self, jumlah):
        self._stok += jumlah

    # Kurangi stok
    def kurangi_stok(self, jumlah):
        if jumlah > self._stok:
            print(f"Stok buku '{self.judul}' tidak mencukupi!")
            return False
        self._stok -= jumlah
        return True

    # Info Buku
    def info_buku(self):
        print(f"[{self.kode_buku}] {self.judul} - {self.penulis} | Stok: {self._stok} | Rak: {self.__lokasi_rak}")



# CLASS PEMINJAMAN 
class Peminjaman:
    def __init__(self, kode_buku, tanggal_pinjam, tanggal_kembali, status="Dipinjam"):
        self.kode_buku = kode_buku
        self.tanggal_pinjam = tanggal_pinjam
        self.tanggal_kembali = tanggal_kembali
        self.status = status

    def info_peminjaman(self):
        return f"{self.kode_buku} | Pinjam: {self.tanggal_pinjam} | Kembali: {self.tanggal_kembali} | Status: {self.status}"



# CLASS ANGGOTA 
class Anggota:
    def __init__(self, id_anggota, nama, maks_pinjam):
        self.id_anggota = id_anggota        # Public
        self.nama = nama                    # Public
        self._maks_pinjam = maks_pinjam     # Protected
        self.__status_aktif = True          # Private
        self.daftar_peminjaman = []         # Aggregation

    # Getter-Setter Status Anggota (private)
    def get_status(self):
        return self.__status_aktif

    def set_status(self, status_baru: bool):
        self.__status_aktif = status_baru

    # Pinjam Buku
    def pinjam_buku(self, buku: Buku, tanggal_pinjam, tanggal_kembali):
        if not self.__status_aktif:
            print(f"Anggota {self.nama} tidak aktif!")
            return
        if len(self.daftar_peminjaman) >= self._maks_pinjam:
            print(f"{self.nama} sudah mencapai batas maksimal peminjaman!")
            return

        if buku.kurangi_stok(1):
            pem = Peminjaman(buku.kode_buku, tanggal_pinjam, tanggal_kembali)
            self.daftar_peminjaman.append(pem)
            print(f"{self.nama} berhasil meminjam buku '{buku.judul}'")
        else:
            print(f"Peminjaman gagal.")

    # Kembalikan Buku
    def kembalikan_buku(self, kode_buku):
        for p in self.daftar_peminjaman:
            if p.kode_buku == kode_buku and p.status == "Dipinjam":
                p.status = "Dikembalikan"
                print(f"{self.nama} mengembalikan buku {kode_buku}")
                return
        print(f"Buku {kode_buku} tidak ditemukan dalam daftar pinjaman {self.nama}")

    # Info Anggota
    def info_anggota(self):
        print(f"ID: {self.id_anggota}, Nama: {self.nama}, Status: {self.__status_aktif}")
        print("Daftar Peminjaman:")
        if not self.daftar_peminjaman:
            print("  - Tidak ada peminjaman")
        for p in self.daftar_peminjaman:
            print("  -", p.info_peminjaman())



#  CLASS PERPUSTAKAAN  
class Perpustakaan:
    def __init__(self, nama):
        self.nama = nama
        self.daftar_buku = []  # Composition

    def tambah_buku(self, judul, penulis, kode, stok, rak):
        buku = Buku(judul, penulis, kode, stok, rak)
        self.daftar_buku.append(buku)
        return buku

    def info_semua_buku(self):
        print(f"\n=== Daftar Buku di {self.nama} ===")
        for b in self.daftar_buku:
            b.info_buku()
        print("-" * 40)



# DEMONSTRASI PROGRAM 
if __name__ == "__main__":
    # Membuat perpustakaan
    perpustakaan = Perpustakaan("Perpustakaan Universitas A")

    # 3 Buku
    buku1 = perpustakaan.tambah_buku("Python Dasar", "John", "B001", 5, "A1")
    buku2 = perpustakaan.tambah_buku("Struktur Data", "Alice", "B002", 3, "B1")
    buku3 = perpustakaan.tambah_buku("Database", "Marry", "B003", 4, "C2")

    # 2 Anggota
    a1 = Anggota("AG01", "Nana", 2)
    a2 = Anggota("AG02", "Heci", 3)

    # Peminjaman buku
    a1.pinjam_buku(buku1, "2024-11-01", "2024-11-10")
    a1.pinjam_buku(buku2, "2024-11-02", "2024-11-11")
    a2.pinjam_buku(buku3, "2024-11-03", "2024-11-12")

    # Pengembalian
    a1.kembalikan_buku("B001")

    # Tampilkan Informasi
    perpustakaan.info_semua_buku()
    print("\n=== Informasi Anggota ===")
    a1.info_anggota()
    print()
    a2.info_anggota()
